const lineup = [
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 1,
    "fields": {
      "artist_name": "Almero",
      "genre": "Afrotech",
      "start_time": "16:00:00",
      "end_time": "18:00:00",
      "day_of_week": 0,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 2,
    "fields": {
      "artist_name": "Yo-Gurt",
      "genre": "Dark Disco",
      "start_time": "18:00:00",
      "end_time": "19:30:00",
      "day_of_week": 0,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 3,
    "fields": {
      "artist_name": "Shmikesss",
      "genre": "Indie House",
      "start_time": "19:30:00",
      "end_time": "21:00:00",
      "day_of_week": 0,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 4,
    "fields": {
      "artist_name": "Audiojerk",
      "genre": "Electronica",
      "start_time": "21:00:00",
      "end_time": "23:00:00",
      "day_of_week": 0,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 5,
    "fields": {
      "artist_name": "Ivan Turanjanin",
      "genre": "Dark Techno",
      "start_time": "23:00:00",
      "end_time": "01:00:00",
      "day_of_week": 0,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 6,
    "fields": {
      "artist_name": "Todd Duff",
      "genre": "Techno",
      "start_time": "01:00:00",
      "end_time": "03:00:00",
      "day_of_week": 0,
      "time_period": 3
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 7,
    "fields": {
      "artist_name": "Yoga w/ Eva",
      "genre": "Sweet Yoga",
      "start_time": "08:00:00",
      "end_time": "09:00:00",
      "day_of_week": 1,
      "time_period": 0
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 8,
    "fields": {
      "artist_name": "Hoop Class w/ Tracy",
      "genre": "Hoopin",
      "start_time": "09:00:00",
      "end_time": "10:00:00",
      "day_of_week": 1,
      "time_period": 0
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 9,
    "fields": {
      "artist_name": "Amith",
      "genre": "Example genre",
      "start_time": "10:00:00",
      "end_time": "12:00:00",
      "day_of_week": 1,
      "time_period": 0
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 10,
    "fields": {
      "artist_name": "Mahandana",
      "genre": "Example genre",
      "start_time": "12:00:00",
      "end_time": "13:30:00",
      "day_of_week": 1,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 11,
    "fields": {
      "artist_name": "Sides",
      "genre": "Example genre",
      "start_time": "13:30:00",
      "end_time": "15:00:00",
      "day_of_week": 1,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 12,
    "fields": {
      "artist_name": "Sebby",
      "genre": "Example genre",
      "start_time": "15:00:00",
      "end_time": "16:30:00",
      "day_of_week": 1,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 13,
    "fields": {
      "artist_name": "Steph Vass",
      "genre": "Example genre",
      "start_time": "16:30:00",
      "end_time": "18:00:00",
      "day_of_week": 1,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 14,
    "fields": {
      "artist_name": "Karoo",
      "genre": "Example genre",
      "start_time": "18:00:00",
      "end_time": "20:00:00",
      "day_of_week": 1,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 15,
    "fields": {
      "artist_name": "Sonic Bloom",
      "genre": "Example genre",
      "start_time": "20:00:00",
      "end_time": "21:30:00",
      "day_of_week": 1,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 16,
    "fields": {
      "artist_name": "Ryan Hill",
      "genre": "Example genre",
      "start_time": "21:30:00",
      "end_time": "23:30:00",
      "day_of_week": 1,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 17,
    "fields": {
      "artist_name": "Lewis",
      "genre": "Example genre",
      "start_time": "23:30:00",
      "end_time": "01:30:00",
      "day_of_week": 1,
      "time_period": 2
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 18,
    "fields": {
      "artist_name": "Rabbit",
      "genre": "Example genre",
      "start_time": "01:30:00",
      "end_time": "03:00:00",
      "day_of_week": 1,
      "time_period": 3
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 19,
    "fields": {
      "artist_name": "Portal",
      "genre": "Example genre",
      "start_time": "03:00:00",
      "end_time": "05:00:00",
      "day_of_week": 1,
      "time_period": 3
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 20,
    "fields": {
      "artist_name": "Yoga w/ Shelby",
      "genre": "Yoga flows",
      "start_time": "08:00:00",
      "end_time": "09:00:00",
      "day_of_week": 2,
      "time_period": 0
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 21,
    "fields": {
      "artist_name": "Josh Mac",
      "genre": "Example genre",
      "start_time": "09:00:00",
      "end_time": "11:00:00",
      "day_of_week": 2,
      "time_period": 0
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 22,
    "fields": {
      "artist_name": "Tall Tales",
      "genre": "Example genre",
      "start_time": "11:00:00",
      "end_time": "12:00:00",
      "day_of_week": 2,
      "time_period": 0
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 23,
    "fields": {
      "artist_name": "Geometric Flux",
      "genre": "Example genre",
      "start_time": "12:00:00",
      "end_time": "13:00:00",
      "day_of_week": 2,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 24,
    "fields": {
      "artist_name": "Freedom Fighters",
      "genre": "Example genre",
      "start_time": "13:00:00",
      "end_time": "16:00:00",
      "day_of_week": 2,
      "time_period": 1
    }
  },
  {
    "model": "habitat_pwa.artistlineup",
    "pk": 25,
    "fields": {
      "artist_name": "Breaker",
      "genre": "Example genre",
      "start_time": "16:00:00",
      "end_time": "17:00:00",
      "day_of_week": 2,
      "time_period": 1
    }
  }
]

const dbPromise = idb.open('lineup-db', 1, function (upgradeDb) {
    upgradeDb.createObjectStore('lineup', {keyPath: 'pk'});
});

fetch('http://127.0.0.1:8000/getdata').then(function (response) {
    return response.json();
}).then(function (jsondata) {
    console.log(jsondata)
    dbPromise.then(function(db){
        var tx = db.transaction('lineup', 'readwrite');
        var lineupStore = tx.objectStore('lineup');
        for(var key in jsondata) {
            if (jsondata.hasOwnProperty(key)) {
                lineupStore.put(jsondata[key]);
            }
     }
    });
});

const scheduleList = document.querySelector('.schedule-list');
const filterButton = document.querySelectorAll('.filter-button');
const filterButtons = document.querySelectorAll('.day-selector *');

const navFilterButton = document.querySelectorAll('.nav-item');
const navFilterButtons = document.querySelectorAll('.navbar *');


//
window.addEventListener('DOMContentLoaded', function () {
    let startDay = lineup.filter(function (lineupItem) {
        if (String(lineupItem.fields.day_of_week) === "0") {
            return lineupItem;
        }
    })
    displayLineupItems(startDay);
})

//
filterButton.forEach(function (btn) {
    btn.addEventListener('click', function (e) {
        removeActiveFromDaySelector();
        btn.classList.add('day-select-active');
        const dayId = e.currentTarget.dataset.id;
        const lineupDay = lineup.filter(function (lineupItem) {
            if (String(lineupItem.fields.day_of_week) === dayId) {
                return lineupItem;
            }
        });
        console.log(lineupDay);
        displayLineupItems(lineupDay);
    });
});


// navFilterButton.forEach(function (btn) {
//     btn.addEventListener('click', function (e) {
//       removeActiveFromNavSelector();
//       btn.classList.add('navbar-select-active');
//     })
// })
//
// function removeActiveFromNavSelector() {
//     navFilterButtons.forEach((element) => {
//         element.classList.remove('navbar-select-active');
//     })
// }

function removeActiveFromDaySelector() {
    filterButtons.forEach((element) => {
        element.classList.remove('day-select-active');
    })
}


function displayLineupItems(lineupItems) {
    let displayLineup = lineupItems.map(function (item) {
        return `<li class="schedule-card">
                <p class="schedule-card-title">${item.fields.artist_name}</p>
                <p class="schedule-card-genre">${item.fields.genre}</p>
                <p class="schedule-card-time">${item.fields.start_time} - ${item.fields.end_time}</p>
            </li>`;
    });
    displayLineup = displayLineup.join("");
    scheduleList.innerHTML = displayLineup;
}

// let post="";
// 	dbPromise.then(function(db){
// 		let tx = db.transaction('lineup', 'readonly');
//   		let feedsStore = tx.objectStore('lineup');
//   		return feedsStore.openCursor();
// 	}).then(function logItems(cursor) {
// 		  if (!cursor) {
// 		  	document.getElementById('offlinedata').innerHTML=post;
// 		    return;
// 		  }
// 		  for (let field in cursor.value) {
// 		    	if(field == 'fields') {
// 		    		feedsData = cursor.value[field];
// 		    		for(var key in feedsData){
// 		    			if(key =='artist_name'){
// 		    				var artist_name = '<p class="schedule-card-title">'+feedsData[key]+'</p>';
// 		    			}
// 		    			if(key =='genre'){
// 		    				var genre = '<p class="schedule-card-genre-title">'+feedsData[key]+'</p>';
// 		    			}
// 		    			if(key == 'start_time'){
// 		    				var start_time = feedsData[key];
// 		    			}
//                         if(key == 'end_time'){
// 		    				var end_time = feedsData[key];
// 		    			}
// 		    		}
//                     let set_time = '<p className="schedule-card-time">' + start_time + '</p>';
// 		    		post=post+'<br>' + artist_name + '<br>' + genre + '<br>' + set_time + '<br>';
// 		    	}
// 		    }
// 		  return cursor.continue().then(logItems);
// 		});

